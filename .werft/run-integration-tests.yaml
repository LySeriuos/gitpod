args:
- name: version
  desc: "The version of the integration tests to use"
  required: true
- name: namespace
  desc: "The namespace to run the integration test against"
  required: true
pod:
  serviceAccount: werft
  nodeSelector:
    dev/workload: workload
  imagePullSecrets:
  - name: eu-gcr-io-pull-secret
  containers:
  - name: tests
    image: eu.gcr.io/gitpod-core-dev/build/integration-tests:{{ .Annotations.version }}
    workingDir: /workspace
    imagePullPolicy: Always
    command:
    - sh
    - -c
    - |
      apk add moreutils

      /entrypoint.sh -kubeconfig=in-cluster -namespace={{ .Annotations.namespace }} 2>&1 | ts "[int-tests] "
      RC=$?
      echo "[int-tests|DONE]"
      exit $RC